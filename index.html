<!DOCTYPE html>
<html lang="ar" dir="rtl" id="htmlTag">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title id="pageTitle">Ù„Ø¹Ø¨Ø© Ø§Ù„Ø´Ø·Ø±Ù†Ø¬ Pro - v1.8</title>
  <style>
    :root {
      --bg: linear-gradient(135deg,#1a1a2e,#16213e,#0f0f23);
      --panel-bg: rgba(255, 255, 255, 0.1);
      --text: #fff;
      --board-wrapper: linear-gradient(145deg,#8B4513,#654321,#3d2817);
      --sq-light: #f0d9b5;
      --sq-dark: #b58863;
    }
    [data-theme="light"] {
      --bg: linear-gradient(135deg,#e0e0e0,#f5f5f5);
      --panel-bg: rgba(0, 0, 0, 0.1);
      --text: #333;
      --board-wrapper: #8d8d8d;
      --sq-light: #ffffff;
      --sq-dark: #d1d1d1;
    }

    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: var(--bg);
      min-height: 100vh;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      padding: 10px; color: var(--text); transition: 0.3s;
    }

    .settings-bar { display: flex; gap: 8px; margin-bottom: 15px; flex-wrap: wrap; justify-content: center; }
    select, .action-btn, .top-btn {
      padding: 8px 12px; border-radius: 8px; border: none; cursor: pointer;
      background: linear-gradient(145deg,#8B4513,#654321);
      color: white; font-weight: bold; font-size: 0.9rem; box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    }

    h1 { font-size: 2rem; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); margin-bottom: 5px; }
    .copyright { font-size: 0.8rem; margin-bottom: 15px; opacity: 0.7; }

    .container { display: flex; gap: 20px; flex-wrap: wrap; justify-content: center; align-items: flex-start; }
    
    .board-wrapper {
      background: var(--board-wrapper);
      padding: 12px; border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
      transition: transform 0.6s ease;
    }

    .board {
      display: grid; grid-template-columns: repeat(8, 55px); grid-template-rows: repeat(8, 55px);
      border: 2px solid #333;
    }

    .square { width: 55px; height: 55px; display: flex; align-items: center; justify-content: center; position: relative; cursor: pointer; }
    .square.light { background: var(--sq-light); }
    .square.dark { background: var(--sq-dark); }
    .square.selected { background: #7cb342 !important; }
    .square.last-move { background: rgba(255, 255, 0, 0.4) !important; }
    .square.check { background: #ff5252 !important; animation: pulse 1s infinite; }
    .square.valid-move::after { content: ''; width: 16px; height: 16px; background: rgba(0,0,0,0.2); border-radius: 50%; }

    @keyframes pulse { 0%, 100% { box-shadow: inset 0 0 10px red; } 50% { box-shadow: inset 0 0 25px red; } }

    .piece { width: 90%; height: 90%; background-size: contain; background-repeat: no-repeat; background-position: center; transition: transform 0.3s; }
    .flipped-board { transform: rotate(180deg); }
    .flipped-piece { transform: rotate(180deg); }

    /* Ø±Ø¨Ø· ØµÙˆØ± Ø§Ù„Ù‚Ø·Ø¹ */
    .p-wk { background-image: url('https://github.com/owakcx2014/chess-png/blob/main/wk.png?raw=true'); }
    .p-wq { background-image: url('https://github.com/owakcx2014/chess-png/blob/main/wq.png?raw=true'); }
    .p-wr { background-image: url('https://github.com/owakcx2014/chess-png/blob/main/wr.png?raw=true'); }
    .p-wb { background-image: url('https://github.com/owakcx2014/chess-png/blob/main/wb.png?raw=true'); }
    .p-wn { background-image: url('https://github.com/owakcx2014/chess-png/blob/main/wn.png?raw=true'); }
    .p-wp { background-image: url('https://github.com/owakcx2014/chess-png/blob/main/wp.png?raw=true'); }
    .p-bk { background-image: url('https://github.com/owakcx2014/chess-png/blob/main/bk.png?raw=true'); }
    .p-bq { background-image: url('https://github.com/owakcx2014/chess-png/blob/main/bq.png?raw=true'); }
    .p-br { background-image: url('https://github.com/owakcx2014/chess-png/blob/main/br.png?raw=true'); }
    .p-bb { background-image: url('https://github.com/owakcx2014/chess-png/blob/main/bb.png?raw=true'); }
    .p-bn { background-image: url('https://github.com/owakcx2014/chess-png/blob/main/bn.png?raw=true'); }
    .p-bp { background-image: url('https://github.com/owakcx2014/chess-png/blob/main/bp.png?raw=true'); }

    .panel {
      background: var(--panel-bg); backdrop-filter: blur(10px);
      padding: 15px; border-radius: 15px; min-width: 280px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3); text-align: center;
    }
    .history-box { height: 100px; overflow-y: auto; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px; margin: 10px 0; font-size: 0.8rem; text-align: left; }
    
    .promo-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: none; align-items: center; justify-content: center; z-index: 5000; }
    .promo-box { background: #3d2817; padding: 25px; border-radius: 20px; display: flex; gap: 20px; border: 2px solid gold; }

    @media (max-width: 600px) {
      .board { grid-template-columns: repeat(8, 42px); grid-template-rows: repeat(8, 42px); }
      .square { width: 42px; height: 42px; }
      .panel { width: 100%; }
    }
  </style>
</head>
<body>

  <div class="settings-bar">
    <select id="langSelect" onchange="applyLang()">
      <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
      <option value="en">English</option>
      <option value="es">EspaÃ±ol</option>
      <option value="fr">FranÃ§ais</option>
      <option value="ja">æ—¥æœ¬èª</option>
      <option value="zh">ä¸­æ–‡</option>
      <option value="ru">Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
    </select>
    <select id="themeSelect" onchange="document.body.setAttribute('data-theme', this.value)">
      <option value="dark">ğŸŒ™ Ø¯Ø§ÙƒÙ†</option>
      <option value="light">â˜€ï¸ ÙØ§ØªØ­</option>
    </select>
    <select id="aiLevel">
      <option value="0" class="t-pvp">ğŸ‘¤ Ù„Ø§Ø¹Ø¨ Ø¶Ø¯ Ù„Ø§Ø¹Ø¨</option>
      <option value="1" class="t-robot">ğŸ¤– Ø±ÙˆØ¨ÙˆØª (Ø³Ù‡Ù„)</option>
      <option value="3" class="t-robot">ğŸ¤– Ø±ÙˆØ¨ÙˆØª (Ù‚ÙˆÙŠ)</option>
      <option value="5" class="t-robot">ğŸ¤– Ø±ÙˆØ¨ÙˆØª (Ù…Ø­ØªØ±Ù)</option>
    </select>
    <button id="flipBtn" onclick="toggleFlip()">ğŸ”„ ØªØ¯ÙˆÙŠØ±: Ø¥ÙŠÙ‚Ø§Ù</button>
  </div>

  <h1 id="mTitle">Ù„Ø¹Ø¨Ø© Ø§Ù„Ø´Ø·Ø±Ù†Ø¬</h1>
  <div class="copyright">Ø§Ù„Ø¥ØµØ¯Ø§Ø± 1.8 - Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ø·Ø¨Ø¹ ÙˆØ§Ù„Ù†Ø´Ø± Ù„Ù€ c00lkiddX17</div>

  <div class="container">
    <div class="board-wrapper" id="boardWrap"><div class="board" id="board"></div></div>
    
    <div class="panel">
      <h2 id="statusMsg">Ø¯ÙˆØ± Ø§Ù„Ø£Ø¨ÙŠØ¶</h2>
      <div class="history-box" id="hBox"></div>
      <div style="display:flex; gap:8px">
        <button class="action-btn" style="flex:1" onclick="undo()" id="uBtn">â†© ØªØ±Ø§Ø¬Ø¹</button>
        <button class="action-btn" style="flex:1" onclick="resetGame()" id="rBtn">ğŸ”„ Ø¬Ø¯ÙŠØ¯Ø©</button>
      </div>
      <button class="action-btn" style="width:100%; margin-top:10px; background: #2e7d32" onclick="downloadOffline()" id="dlBtn">ğŸ“¥ Ø­ÙØ¸ Ù†Ø³Ø®Ø© HTML Ø£ÙˆÙÙ„Ø§ÙŠÙ†</button>
    </div>
  </div>

  <div class="promo-overlay" id="pOverlay"><div class="promo-box" id="pBox"></div></div>

  <script>
    // --- Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„ØºØ§Øª Ø§Ù„ÙƒØ§Ù…Ù„Ø© ---
    const i18n = {
      ar: { m: "Ù„Ø¹Ø¨Ø© Ø§Ù„Ø´Ø·Ø±Ù†Ø¬ Pro", w: "Ø¯ÙˆØ± Ø§Ù„Ø£Ø¨ÙŠØ¶", b: "Ø¯ÙˆØ± Ø§Ù„Ø£Ø³ÙˆØ¯", c: "ÙƒØ´!", mate: "ÙƒØ´ Ù…Ù„Ùƒ! ÙØ§Ø²: ", dr: "ØªØ¹Ø§Ø¯Ù„!", undo: "ØªØ±Ø§Ø¬Ø¹", res: "Ø¬Ø¯ÙŠØ¯Ø©", fOn: "ØªØ¯ÙˆÙŠØ±: ØªØ´ØºÙŠÙ„", fOff: "ØªØ¯ÙˆÙŠØ±: Ø¥ÙŠÙ‚Ø§Ù", dl: "Ø­ÙØ¸ Ù†Ø³Ø®Ø© HTML Ø£ÙˆÙÙ„Ø§ÙŠÙ†", pvp: "Ù„Ø§Ø¹Ø¨ Ø¶Ø¯ Ù„Ø§Ø¹Ø¨", robot: "Ø±ÙˆØ¨ÙˆØª" },
      en: { m: "Chess Pro Game", w: "White's Turn", b: "Black's Turn", c: "Check!", mate: "Checkmate! Winner: ", dr: "Stalemate!", undo: "Undo", res: "New", fOn: "Flip: ON", fOff: "Flip: OFF", dl: "Download Offline HTML", pvp: "Player vs Player", robot: "Robot" },
      es: { m: "Ajedrez Profesional", w: "Turno Blanco", b: "Turno Negro", c: "Â¡Jaque!", mate: "Â¡Jaque mate! Ganador: ", dr: "Â¡Empate!", undo: "Deshacer", res: "Nuevo", fOn: "Girar: SI", fOff: "Girar: NO", dl: "Descargar HTML", pvp: "Jugador vs Jugador", robot: "Robot" },
      fr: { m: "Ã‰checs Pro", w: "Tour Blanc", b: "Tour Noir", c: "Ã‰chec!", mate: "Ã‰chec et mat! Gagnant: ", dr: "Nul!", undo: "Annuler", res: "Nouveau", fOn: "Rotation: OUI", fOff: "Rotation: NON", dl: "TÃ©lÃ©charger HTML", pvp: "Joueur contre Joueur", robot: "Robot" },
      ja: { m: "ãƒ—ãƒ­ãƒã‚§ã‚¹", w: "ç™½ã®ç•ª", b: "é»’ã®ç•ª", c: "ãƒã‚§ãƒƒã‚¯ï¼", mate: "ãƒã‚§ãƒƒã‚¯ãƒ¡ã‚¤ãƒˆï¼å‹è€…: ", dr: "å¼•ãåˆ†ã‘", undo: "å¾…ã£ãŸ", res: "æ–°ã‚²ãƒ¼ãƒ ", fOn: "å›è»¢: ã‚ªãƒ³", fOff: "å›è»¢: ã‚ªãƒ•", dl: "ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ç‰ˆä¿å­˜", pvp: "å¯¾äººæˆ¦", robot: "ãƒ­ãƒœãƒƒãƒˆ" },
      zh: { m: "ä¸“ä¸šå›½é™…è±¡æ£‹", w: "ç™½æ–¹èµ°å­", b: "é»‘æ–¹èµ°å­", c: "å°†å†›ï¼", mate: "æ­»å±€ï¼è·èƒœè€…: ", dr: "å’Œæ£‹", undo: "æ’¤é”€", res: "é‡æ–°å¼€å§‹", fOn: "æ—‹è½¬: å¼€å¯", fOff: "æ—‹è½¬: å…³é—­", dl: "ä¿å­˜ç¦»çº¿ç‰ˆæœ¬", pvp: "ç©å®¶å¯¹æˆ˜", robot: "æœºå™¨äºº" },
      ru: { m: "Ğ¨Ğ°Ñ…Ğ¼Ğ°Ñ‚Ñ‹ ĞŸÑ€Ğ¾", w: "Ğ¥Ğ¾Ğ´ Ğ±ĞµĞ»Ñ‹Ñ…", b: "Ğ¥Ğ¾Ğ´ Ñ‡ĞµÑ€Ğ½Ñ‹Ñ…", c: "Ğ¨Ğ°Ñ…!", mate: "ĞœĞ°Ñ‚! ĞŸĞ¾Ğ±ĞµĞ´Ğ¸Ñ‚ĞµĞ»ÑŒ: ", dr: "ĞĞ¸Ñ‡ÑŒÑ", undo: "ĞĞ°Ğ·Ğ°Ğ´", res: "ĞĞ¾Ğ²Ğ°Ñ Ğ¸Ğ³Ñ€Ğ°", fOn: "ĞŸĞ¾Ğ²Ğ¾Ñ€Ğ¾Ñ‚: Ğ’ĞšĞ›", fOff: "ĞŸĞ¾Ğ²Ğ¾Ñ€Ğ¾Ñ‚: Ğ’Ğ«ĞšĞ›", dl: "Ğ¡ĞºĞ°Ñ‡Ğ°Ñ‚ÑŒ ĞÑ„Ñ„Ğ»Ğ°Ğ¹Ğ½", pvp: "Ğ˜Ğ³Ñ€Ğ¾Ğº Ğ¿Ñ€Ğ¾Ñ‚Ğ¸Ğ² Ğ˜Ğ³Ñ€Ğ¾ĞºĞ°", robot: "Ğ Ğ¾Ğ±Ğ¾Ñ‚" }
    };

    let b=[], turn='white', sel=null, moves=[], lm=null, hist=[], gh=[], ck=false, end=false, flip=false, lang='ar';

    function init() {
      b=Array(8).fill(null).map(()=>Array(8).fill(null));
      const r=['rook','knight','bishop','queen','king','bishop','knight','rook'];
      for(let i=0;i<8;i++){
        b[0][i]={t:r[i],c:'black',m:false}; b[1][i]={t:'pawn',c:'black',m:false};
        b[6][i]={t:'pawn',c:'white',m:false}; b[7][i]={t:r[i],c:'white',m:false};
      }
    }

    function applyLang() {
      lang = document.getElementById('langSelect').value;
      const d = i18n[lang];
      document.getElementById('mTitle').textContent = d.m;
      document.getElementById('uBtn').textContent = "â†© " + d.undo;
      document.getElementById('rBtn').textContent = "ğŸ”„ " + d.res;
      document.getElementById('dlBtn').textContent = "ğŸ“¥ " + d.dl;
      document.getElementById('htmlTag').dir = (lang==='ar'?'rtl':'ltr');
      
      // ØªØ­Ø¯ÙŠØ« Ù†ØµÙˆØµ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
      document.querySelector('.t-pvp').textContent = "ğŸ‘¤ " + d.pvp;
      document.querySelectorAll('.t-robot').forEach((el, i) => {
          const lvls = [1, 3, 5];
          el.textContent = "ğŸ¤– " + d.robot + " (" + lvls[i] + ")";
      });

      updateFlipBtnText(); render();
    }

    function getMoves(board, r, c, ignoreCheck=false) {
      const p=board[r][c]; if(!p) return [];
      let m=[]; const d=p.c==='white'?-1:1;
      const inB=(r,c)=>r>=0&&r<8&&c>=0&&c<8;

      if(p.t==='pawn'){
        if(inB(r+d,c)&&!board[r+d][c]){ m.push({r:r+d,c}); if(!p.m&&!board[r+2*d][c]) m.push({r:r+2*d,c}); }
        [[-1,d],[1,d]].forEach(o=>{
            let nr=r+o[1], nc=c+o[0];
            if(inB(nr,nc)&&board[nr][nc]&&board[nr][nc].c!==p.c) m.push({r:nr,c:nc});
        });
      } else if(['knight','king'].includes(p.t)){
        const o=p.t==='knight'?[[-2,-1],[-2,1],[-1,-2],[-1,2],[1,-2],[1,2],[2,-1],[2,1]]:[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];
        o.forEach(o=>{ let nr=r+o[0],nc=c+o[1]; if(inB(nr,nc)&&(!board[nr][nc]||board[nr][nc].c!==p.c)) m.push({r:nr,c:nc}); });
      } else {
        const ds=p.t==='rook'?[[0,1],[0,-1],[1,0],[-1,0]]:p.t==='bishop'?[[1,1],[1,-1],[-1,1],[-1,-1]]:[[0,1],[0,-1],[1,0],[-1,0],[1,1],[1,-1],[-1,1],[-1,-1]];
        ds.forEach(dr=>{
          for(let i=1;i<8;i++){
            let nr=r+dr[0]*i,nc=c+dr[1]*i; if(!inB(nr,nc))break;
            if(!board[nr][nc]) m.push({r:nr,c:nc}); else { if(board[nr][nc].c!==p.c) m.push({r:nr,c:nc}); break; }
          }
        });
      }
      return ignoreCheck?m:m.filter(mv=>{
        let nb=JSON.parse(JSON.stringify(board)); nb[mv.r][mv.c]=nb[r][c]; nb[r][c]=null;
        return !testCheck(nb, p.c);
      });
    }

    function testCheck(board, color) {
      let k; for(let r=0;r<8;r++)for(let c=0;c<8;c++)if(board[r][c]&&board[r][c].t==='king'&&board[r][c].c===color)k={r,c};
      if(!k) return false;
      const en=color==='white'?'black':'white';
      for(let r=0;r<8;r++)for(let c=0;c<8;c++)if(board[r][c]&&board[r][c].c===en)if(getMoves(board,r,c,true).some(m=>m.r===k.r&&m.c===k.c))return true;
      return false;
    }

    function render() {
      const el=document.getElementById('board'); el.innerHTML='';
      const wr=document.getElementById('boardWrap');
      if(flip && turn==='black') wr.classList.add('flipped-board'); else wr.classList.remove('flipped-board');

      for(let r=0;r<8;r++)for(let c=0;c<8;c++){
        const sq=document.createElement('div'); sq.className=`square ${(r+c)%2===0?'light':'dark'}`;
        if(sel&&sel.r===r&&sel.c===c)sq.classList.add('selected');
        if(lm&&((lm.fr===r&&lm.fc===c)||(lm.tr===r&&lm.tc===c)))sq.classList.add('last-move');
        if(ck&&b[r][c]&&b[r][c].t==='king'&&b[r][c].c===turn)sq.classList.add('check');
        if(moves.some(m=>m.r===r&&m.c===c))sq.classList.add('valid-move');
        sq.onclick=()=>clickSq(r,c);
        if(b[r][c]){
          const pe=document.createElement('div');
          const tk=b[r][c].t==='knight'?'n':b[r][c].t[0];
          pe.className=`piece p-${b[r][c].c[0]}${tk}`;
          if(flip && turn==='black') pe.classList.add('flipped-piece');
          sq.appendChild(pe);
        }
        el.appendChild(sq);
      }
      updateUI();
    }

    function clickSq(r,c) {
      if(end)return;
      const mv=moves.find(m=>m.r===r&&m.c===c);
      if(sel && mv){
        gh.push(JSON.stringify({b,turn,lm,hist}));
        const p=b[sel.r][sel.c]; b[r][c]=p; b[sel.r][sel.c]=null; p.m=true;
        lm={fr:sel.r,fc:sel.c,tr:r,tc:c};
        hist.push(`${p.c[0].toUpperCase()}: ${'abcdefgh'[sel.c]}${8-sel.r}â†’${'abcdefgh'[c]}${8-r}`);
        if(p.t==='pawn'&&(r===0||r===7)){ showPromo(r,c); return; }
        finalize();
      } else if(b[r][c]&&b[r][c].c===turn){ sel={r,c}; moves=getMoves(b,r,c); render(); }
      else { sel=null; moves=[]; render(); }
    }

    function finalize() {
      turn=turn==='white'?'black':'white';
      ck=testCheck(b,turn);
      let can=false;
      for(let r=0;r<8;r++)for(let c=0;c<8;c++)if(b[r][c]&&b[r][c].c===turn&&getMoves(b,r,c).length>0)can=true;
      if(!can) end=true;
      sel=null; moves=[]; render();
      const ai=parseInt(document.getElementById('aiLevel').value);
      if(ai>0 && turn==='black' && !end) setTimeout(()=>aiPlay(ai), 600);
    }

    function showPromo(r,c) {
      const ov=document.getElementById('pOverlay'); ov.style.display='flex';
      const box=document.getElementById('pBox'); box.innerHTML='';
      ['queen','rook','bishop','knight'].forEach(t=>{
        const d=document.createElement('div'); d.className=`piece p-${b[r][c].c[0]}${t==='knight'?'n':t[0]}`;
        d.style.width='60px'; d.style.height='60px'; d.style.cursor='pointer';
        d.onclick=()=>{ b[r][c].t=t; ov.style.display='none'; finalize(); };
        box.appendChild(d);
      });
    }

    function aiPlay(l) {
      let ms=[];
      for(let r=0;r<8;r++)for(let c=0;c<8;c++)if(b[r][c]&&b[r][c].c==='black')
        getMoves(b,r,c).forEach(m=>ms.push({fr:r,fc:c,tr:m.r,tc:m.c}));
      if(!ms.length) return;
      let mv=ms[Math.floor(Math.random()*ms.length)];
      if(l>1){ let caps=ms.filter(m=>b[m.tr][m.tc]); if(caps.length) mv=caps[Math.floor(Math.random()*caps.length)]; }
      clickSq(mv.fr, mv.fc); clickSq(mv.tr, mv.tc);
    }

    function updateUI() {
      const d=i18n[lang];
      document.getElementById('statusMsg').textContent = end ? (ck?d.mate+(turn==='white'?d.b:d.w):d.dr) : (ck?d.c:(turn==='white'?d.w:d.b));
      document.getElementById('hBox').innerHTML = hist.join('<br>');
      document.getElementById('hBox').scrollTop = 9999;
    }

    function updateFlipBtnText() { const d=i18n[lang]; document.getElementById('flipBtn').textContent = flip?"ğŸ”„ "+d.fOn:"ğŸ”„ "+d.fOff; }
    function toggleFlip() { flip=!flip; updateFlipBtnText(); render(); }
    function undo() { if(gh.length){ const l=JSON.parse(gh.pop()); b=l.b; turn=l.turn; lm=l.lm; hist=l.hist; end=false; ck=testCheck(b,turn); render(); } }
    function resetGame() { init(); turn='white'; lm=null; hist=[]; gh=[]; end=ck=false; render(); }

    function downloadOffline() {
      const htmlContent = document.documentElement.outerHTML;
      const blob = new Blob([htmlContent], { type: 'text/html' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'Chess_Pro_v1.8_c00lkiddX17.html';
      a.click();
    }

    init(); applyLang();
  </script>
</body>
</html>